{% extends 'layout.html' %}
{% load static markdown_extras %}

{% block title %}{{ post.title }} - {{ site_title }}{% endblock %}
{% block meta_description %}{{ post.meta_description|default:post.excerpt|truncatewords:30 }}{% endblock %}
{% block meta_keywords %}{{ post.meta_keywords }}{% endblock %}
{% block meta_author %}{{ post.author.get_full_name|default:post.author.username }}{% endblock %}

{% block extra_head %}
<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:title" content="{{ post.title }}">
<meta property="og:description" content="{{ post.meta_description|default:post.excerpt }}">
{% if post.image %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.image.url }}">
{% endif %}

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="{{ request.build_absolute_uri }}">
<meta property="twitter:title" content="{{ post.title }}">
<meta property="twitter:description" content="{{ post.meta_description|default:post.excerpt }}">
{% if post.image %}
<meta property="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.image.url }}">
{% endif %}

<!-- Article Metadata -->
<meta property="article:published_time" content="{{ post.published_date|date:'c' }}">
<meta property="article:modified_time" content="{{ post.updated_date|date:'c' }}">
<meta property="article:author" content="{{ post.author.get_full_name|default:post.author.username }}">
{% if post.category %}
<meta property="article:section" content="{{ post.category.name }}">
{% endif %}
{% for tag in post.tags.all %}
<meta property="article:tag" content="{{ tag.name }}">
{% endfor %}
{% endblock %}

{% block banner_area %}
<section class="blog-hero{% if post.image %} blog-hero--with-image{% endif %}">
    {% if post.image %}
    <img src="{{ post.image.url }}" alt="{{ post.title }}" class="blog-hero__bg" loading="eager">
    {% endif %}
    <div class="container">
        <div class="blog-hero__content">
            {% if post.content_type and post.content_type != 'article' %}
            <span class="blog-hero__content-type">{{ post.get_content_type_display }}</span>
            {% endif %}
            {% if post.category %}
            <a href="{% url 'blog_home' %}?category={{ post.category.slug }}" class="blog-hero__category">
                {{ post.category.name }}
            </a>
            {% endif %}
            <h1 class="blog-hero__title">{{ post.title }}</h1>
            <div class="blog-hero__meta">
                <span class="blog-hero__meta-item">
                    <i class="fa-solid fa-user"></i>
                    {{ post.author.get_full_name|default:post.author.username }}
                </span>
                <span class="blog-hero__meta-item">
                    <i class="fa-solid fa-calendar-days"></i>
                    {{ post.published_date|date:"M d, Y" }}
                </span>
                <span class="blog-hero__meta-item">
                    <i class="fa-solid fa-clock"></i>
                    {{ post.reading_time }} min read
                </span>
                <span class="blog-hero__meta-item">
                    <i class="fa-solid fa-eye"></i>
                    {{ post.view_count }} views
                </span>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="article-body article-body--{{ post.content_type }}">
            {% if post.tags.exists %}
            <div class="mb-4">
                {% for tag in post.tags.all %}
                <span class="blog-card__tag me-1 mb-1 d-inline-block">#{{ tag.name }}</span>
                {% endfor %}
            </div>
            {% endif %}

            <div class="markdown-content">
                {{ post.content|markdown }}
            </div>

            <!-- Share Buttons -->
            <div class="share-buttons">
                <span class="share-buttons__label">Share:</span>
                <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri|urlencode }}&text={{ post.title|urlencode }}"
                   target="_blank" rel="noopener" class="share-btn" title="Share on X">
                    <i class="fa-brands fa-x-twitter"></i>
                </a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}"
                   target="_blank" rel="noopener" class="share-btn" title="Share on LinkedIn">
                    <i class="fa-brands fa-linkedin-in"></i>
                </a>
                <button class="share-btn" onclick="navigator.clipboard.writeText(window.location.href).then(function(){this.innerHTML='<i class=\'fa-solid fa-check\'></i>'}.bind(this))" title="Copy link">
                    <i class="fa-solid fa-link"></i>
                </button>
            </div>

            <!-- Author Card -->
            <div class="author-card">
                <div class="author-card__avatar-placeholder d-flex align-items-center justify-content-center rounded-circle"
                     style="width: 64px; height: 64px; min-width: 64px; background: var(--brand-gradient); color: #fff; font-size: 1.5rem; font-weight: 700;">
                    {{ post.author.get_full_name|default:post.author.username|make_list|first|upper }}
                </div>
                <div>
                    <div class="author-card__name">{{ post.author.get_full_name|default:post.author.username }}</div>
                    <p class="author-card__bio">{{ about_myself_footer|truncatewords:20 }}</p>
                </div>
            </div>

            <!-- Post Navigation -->
            {% if previous_post or next_post %}
            <nav class="post-navigation">
                {% if previous_post %}
                <a href="{% url 'blog_detail' previous_post.slug %}" class="post-navigation__item">
                    <div class="post-navigation__label"><i class="fa-solid fa-arrow-left me-1"></i> Previous</div>
                    <div class="post-navigation__title">{{ previous_post.title }}</div>
                </a>
                {% else %}
                <div></div>
                {% endif %}

                {% if next_post %}
                <a href="{% url 'blog_detail' next_post.slug %}" class="post-navigation__item post-navigation__item--next">
                    <div class="post-navigation__label">Next <i class="fa-solid fa-arrow-right ms-1"></i></div>
                    <div class="post-navigation__title">{{ next_post.title }}</div>
                </a>
                {% else %}
                <div></div>
                {% endif %}
            </nav>
            {% endif %}

            <!-- Back to Blog -->
            <div class="text-center mt-5">
                <a href="{% url 'blog_home' %}" class="btn-gradient">
                    <i class="fa-solid fa-arrow-left me-2"></i> Back to Blog
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}
